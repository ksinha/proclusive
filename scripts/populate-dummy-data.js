const { createClient } = require('@supabase/supabase-js');
const fs = require('fs');
const path = require('path');

// Load .env.local manually
const envPath = path.join(__dirname, '..', '.env.local');
if (fs.existsSync(envPath)) {
  const envContent = fs.readFileSync(envPath, 'utf8');
  envContent.split('\n').forEach(line => {
    const match = line.match(/^([^=:#]+)=(.*)$/);
    if (match) {
      const key = match[1].trim();
      const value = match[2].trim();
      process.env[key] = value;
    }
  });
}

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseKey) {
  console.error('‚ùå Missing Supabase credentials in .env.local');
  console.error('Please ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.');
  process.exit(1);
}

const supabase = createClient(supabaseUrl, supabaseKey);

const dummyProfiles = [
  {
    email: 'john.miller@acmeconstruction.com',
    full_name: 'John Miller',
    company_name: 'Acme Construction Co.',
    phone: '(555) 123-4567',
    business_type: 'LLC',
    primary_trade: 'General Contractor',
    service_areas: ['San Francisco', 'Oakland', 'San Jose'],
    website: 'https://acmeconstruction.com',
    linkedin_url: 'https://linkedin.com/in/johnmiller',
    street_address: '1234 Market Street',
    city: 'San Francisco',
    state: 'CA',
    zip_code: '94102',
    bio: 'Premier general contractor specializing in commercial construction projects. 15 years of experience delivering high-quality builds on time and within budget.',
    years_in_business: 15,
    team_size: '20-50',
    tin_number: '12-3456789',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'sarah.chen@electricpro.com',
    full_name: 'Sarah Chen',
    company_name: 'ElectricPro Solutions',
    phone: '(555) 234-5678',
    business_type: 'Corporation',
    primary_trade: 'Electrical',
    service_areas: ['Los Angeles', 'Pasadena', 'Glendale'],
    website: 'https://electricprosolutions.com',
    linkedin_url: 'https://linkedin.com/in/sarahchen',
    street_address: '5678 Sunset Blvd',
    city: 'Los Angeles',
    state: 'CA',
    zip_code: '90028',
    bio: 'Licensed electrical contractor serving commercial and residential clients. Expert in smart building systems and sustainable energy solutions.',
    years_in_business: 8,
    team_size: '10-20',
    tin_number: '98-7654321',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'mike.rodriguez@plumbingworks.com',
    full_name: 'Mike Rodriguez',
    company_name: 'Rodriguez Plumbing Works',
    phone: '(555) 345-6789',
    business_type: 'Sole Proprietorship',
    primary_trade: 'Plumbing',
    service_areas: ['San Diego', 'Chula Vista', 'Oceanside'],
    website: 'https://rodriguezplumbing.com',
    linkedin_url: 'https://linkedin.com/in/mikerodriguez',
    street_address: '2345 Harbor Dr',
    city: 'San Diego',
    state: 'CA',
    zip_code: '92101',
    bio: 'Family-owned plumbing business with a reputation for reliable service. Specializing in commercial plumbing systems and emergency repairs.',
    years_in_business: 12,
    team_size: '5-10',
    tin_number: '45-6789012',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'jennifer.park@hvacsystems.com',
    full_name: 'Jennifer Park',
    company_name: 'Park HVAC Systems',
    phone: '(555) 456-7890',
    business_type: 'LLC',
    primary_trade: 'HVAC',
    service_areas: ['Sacramento', 'Roseville', 'Folsom'],
    website: 'https://parkhvac.com',
    linkedin_url: 'https://linkedin.com/in/jenniferpark',
    street_address: '7890 J Street',
    city: 'Sacramento',
    state: 'CA',
    zip_code: '95814',
    bio: 'Leading HVAC contractor specializing in commercial climate control systems. Certified in energy-efficient HVAC design and installation.',
    years_in_business: 10,
    team_size: '10-20',
    tin_number: '23-4567890',
    is_public: true,
    vetting_status: 'pending',
  },
  {
    email: 'david.thompson@carpentrymaster.com',
    full_name: 'David Thompson',
    company_name: 'Thompson Carpentry Masters',
    phone: '(555) 567-8901',
    business_type: 'Partnership',
    primary_trade: 'Carpentry',
    service_areas: ['Portland', 'Beaverton', 'Hillsboro'],
    website: 'https://thompsoncarpentry.com',
    linkedin_url: 'https://linkedin.com/in/davidthompson',
    street_address: '3456 SW Broadway',
    city: 'Portland',
    state: 'OR',
    zip_code: '97205',
    bio: 'Master carpenters delivering exceptional custom woodwork and finish carpentry. Known for craftsmanship and attention to detail.',
    years_in_business: 18,
    team_size: '5-10',
    tin_number: '67-8901234',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'lisa.nguyen@roofingexperts.com',
    full_name: 'Lisa Nguyen',
    company_name: 'Nguyen Roofing Experts',
    phone: '(555) 678-9012',
    business_type: 'LLC',
    primary_trade: 'Roofing',
    service_areas: ['Seattle', 'Tacoma', 'Bellevue'],
    website: 'https://nguyenroofing.com',
    linkedin_url: 'https://linkedin.com/in/lisanguyen',
    street_address: '4567 Pike Street',
    city: 'Seattle',
    state: 'WA',
    zip_code: '98101',
    bio: 'Professional roofing contractor with expertise in commercial flat roofs and sustainable roofing materials. Licensed and fully insured.',
    years_in_business: 14,
    team_size: '20-50',
    tin_number: '89-0123456',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'robert.anderson@concrete-pro.com',
    full_name: 'Robert Anderson',
    company_name: 'Anderson Concrete Pro',
    phone: '(555) 789-0123',
    business_type: 'Corporation',
    primary_trade: 'Concrete',
    service_areas: ['Phoenix', 'Scottsdale', 'Tempe'],
    website: 'https://andersonconcrete.com',
    linkedin_url: 'https://linkedin.com/in/robertanderson',
    street_address: '5678 E Camelback Rd',
    city: 'Phoenix',
    state: 'AZ',
    zip_code: '85018',
    bio: 'Leading concrete contractor specializing in large-scale commercial foundations and decorative concrete work. Over 20 years in the industry.',
    years_in_business: 22,
    team_size: '50+',
    tin_number: '34-5678901',
    is_public: true,
    vetting_status: 'pending',
  },
  {
    email: 'amanda.wilson@paintersplus.com',
    full_name: 'Amanda Wilson',
    company_name: 'Wilson Painters Plus',
    phone: '(555) 890-1234',
    business_type: 'LLC',
    primary_trade: 'Painting',
    service_areas: ['Denver', 'Boulder', 'Aurora'],
    website: 'https://wilsonpainters.com',
    linkedin_url: 'https://linkedin.com/in/amandawilson',
    street_address: '6789 Colfax Ave',
    city: 'Denver',
    state: 'CO',
    zip_code: '80220',
    bio: 'Professional painting contractor offering interior and exterior services for commercial properties. Eco-friendly paint options available.',
    years_in_business: 9,
    team_size: '10-20',
    tin_number: '56-7890123',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'carlos.garcia@masonry-works.com',
    full_name: 'Carlos Garcia',
    company_name: 'Garcia Masonry Works',
    phone: '(555) 901-2345',
    business_type: 'Sole Proprietorship',
    primary_trade: 'Masonry',
    service_areas: ['Austin', 'Round Rock', 'Cedar Park'],
    website: 'https://garciamasonry.com',
    linkedin_url: 'https://linkedin.com/in/carlosgarcia',
    street_address: '7890 Congress Ave',
    city: 'Austin',
    state: 'TX',
    zip_code: '78701',
    bio: 'Expert masonry contractor specializing in brick, stone, and concrete block construction. Family business with three generations of experience.',
    years_in_business: 25,
    team_size: '10-20',
    tin_number: '78-9012345',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'emily.brown@flooring-specialists.com',
    full_name: 'Emily Brown',
    company_name: 'Brown Flooring Specialists',
    phone: '(555) 012-3456',
    business_type: 'LLC',
    primary_trade: 'Flooring',
    service_areas: ['Dallas', 'Fort Worth', 'Plano'],
    website: 'https://brownflooring.com',
    linkedin_url: 'https://linkedin.com/in/emilybrown',
    street_address: '8901 Main Street',
    city: 'Dallas',
    state: 'TX',
    zip_code: '75201',
    bio: 'Commercial flooring experts offering installation, refinishing, and maintenance. Specialists in hardwood, tile, and luxury vinyl.',
    years_in_business: 11,
    team_size: '10-20',
    tin_number: '90-1234567',
    is_public: true,
    vetting_status: 'pending',
  },
  {
    email: 'james.lee@steel-fabrication.com',
    full_name: 'James Lee',
    company_name: 'Lee Steel Fabrication',
    phone: '(555) 123-4568',
    business_type: 'Corporation',
    primary_trade: 'Steel Erection',
    service_areas: ['Houston', 'Pasadena', 'Sugar Land'],
    website: 'https://leesteelfab.com',
    linkedin_url: 'https://linkedin.com/in/jameslee',
    street_address: '9012 Westheimer Rd',
    city: 'Houston',
    state: 'TX',
    zip_code: '77042',
    bio: 'Industrial steel fabrication and erection contractor. Specializing in commercial buildings, warehouses, and industrial facilities.',
    years_in_business: 16,
    team_size: '50+',
    tin_number: '12-3456780',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'patricia.martinez@landscaping-pro.com',
    full_name: 'Patricia Martinez',
    company_name: 'Martinez Landscaping Pro',
    phone: '(555) 234-5679',
    business_type: 'LLC',
    primary_trade: 'Landscaping',
    service_areas: ['Miami', 'Fort Lauderdale', 'West Palm Beach'],
    website: 'https://martinezlandscaping.com',
    linkedin_url: 'https://linkedin.com/in/patriciamartinez',
    street_address: '1234 Biscayne Blvd',
    city: 'Miami',
    state: 'FL',
    zip_code: '33132',
    bio: 'Full-service commercial landscaping company. Expert in tropical landscape design, irrigation systems, and ongoing maintenance programs.',
    years_in_business: 13,
    team_size: '20-50',
    tin_number: '23-4567891',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'kevin.patel@drywall-solutions.com',
    full_name: 'Kevin Patel',
    company_name: 'Patel Drywall Solutions',
    phone: '(555) 345-6780',
    business_type: 'Partnership',
    primary_trade: 'Drywall',
    service_areas: ['Atlanta', 'Marietta', 'Alpharetta'],
    website: 'https://pateldrywall.com',
    linkedin_url: 'https://linkedin.com/in/kevinpatel',
    street_address: '2345 Peachtree St',
    city: 'Atlanta',
    state: 'GA',
    zip_code: '30303',
    bio: 'Professional drywall installation and finishing for commercial projects. Known for quality workmanship and meeting tight deadlines.',
    years_in_business: 7,
    team_size: '10-20',
    tin_number: '45-6789013',
    is_public: true,
    vetting_status: 'pending',
  },
  {
    email: 'michelle.kim@glass-glazing.com',
    full_name: 'Michelle Kim',
    company_name: 'Kim Glass & Glazing',
    phone: '(555) 456-7891',
    business_type: 'LLC',
    primary_trade: 'Glazing',
    service_areas: ['Boston', 'Cambridge', 'Somerville'],
    website: 'https://kimglassandglazing.com',
    linkedin_url: 'https://linkedin.com/in/michellekim',
    street_address: '3456 Boylston St',
    city: 'Boston',
    state: 'MA',
    zip_code: '02215',
    bio: 'Commercial glass and glazing contractor specializing in curtain wall systems, storefront glazing, and architectural glass installations.',
    years_in_business: 10,
    team_size: '10-20',
    tin_number: '67-8901235',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'thomas.wright@demolition-experts.com',
    full_name: 'Thomas Wright',
    company_name: 'Wright Demolition Experts',
    phone: '(555) 567-8902',
    business_type: 'Corporation',
    primary_trade: 'Demolition',
    service_areas: ['Chicago', 'Naperville', 'Evanston'],
    website: 'https://wrightdemolition.com',
    linkedin_url: 'https://linkedin.com/in/thomaswright',
    street_address: '4567 S Michigan Ave',
    city: 'Chicago',
    state: 'IL',
    zip_code: '60605',
    bio: 'Licensed demolition contractor with expertise in selective demolition, structural demolition, and environmental abatement services.',
    years_in_business: 19,
    team_size: '20-50',
    tin_number: '89-0123457',
    is_public: true,
    vetting_status: 'rejected',
  },
  {
    email: 'jessica.taylor@insulation-pro.com',
    full_name: 'Jessica Taylor',
    company_name: 'Taylor Insulation Pro',
    phone: '(555) 678-9013',
    business_type: 'LLC',
    primary_trade: 'Insulation',
    service_areas: ['Philadelphia', 'King of Prussia', 'Cherry Hill'],
    website: 'https://taylorinsulation.com',
    linkedin_url: 'https://linkedin.com/in/jessicataylor',
    street_address: '5678 Market Street',
    city: 'Philadelphia',
    state: 'PA',
    zip_code: '19103',
    bio: 'Commercial insulation contractor offering thermal, acoustic, and fire-rated insulation solutions. Energy efficiency experts.',
    years_in_business: 8,
    team_size: '5-10',
    tin_number: '34-5678902',
    is_public: true,
    vetting_status: 'pending',
  },
  {
    email: 'anthony.davis@waterproofing.com',
    full_name: 'Anthony Davis',
    company_name: 'Davis Waterproofing Services',
    phone: '(555) 789-0124',
    business_type: 'Sole Proprietorship',
    primary_trade: 'Waterproofing',
    service_areas: ['New York', 'Brooklyn', 'Queens'],
    website: 'https://daviswaterproofing.com',
    linkedin_url: 'https://linkedin.com/in/anthonydavis',
    street_address: '6789 Broadway',
    city: 'New York',
    state: 'NY',
    zip_code: '10019',
    bio: 'Specialized waterproofing contractor for commercial buildings. Expert in foundation waterproofing, roof membranes, and below-grade protection.',
    years_in_business: 15,
    team_size: '10-20',
    tin_number: '56-7890124',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'nicole.johnson@elevator-services.com',
    full_name: 'Nicole Johnson',
    company_name: 'Johnson Elevator Services',
    phone: '(555) 890-1235',
    business_type: 'Corporation',
    primary_trade: 'Elevator Installation',
    service_areas: ['Las Vegas', 'Henderson', 'Paradise'],
    website: 'https://johnsonelevator.com',
    linkedin_url: 'https://linkedin.com/in/nicolejohnson',
    street_address: '7890 Las Vegas Blvd',
    city: 'Las Vegas',
    state: 'NV',
    zip_code: '89101',
    bio: 'Commercial elevator installation and maintenance company. Certified technicians for hydraulic and traction elevator systems.',
    years_in_business: 12,
    team_size: '20-50',
    tin_number: '78-9012346',
    is_public: true,
    vetting_status: 'approved',
  },
  {
    email: 'brian.white@fire-suppression.com',
    full_name: 'Brian White',
    company_name: 'White Fire Suppression Systems',
    phone: '(555) 901-2346',
    business_type: 'LLC',
    primary_trade: 'Fire Protection',
    service_areas: ['Nashville', 'Franklin', 'Murfreesboro'],
    website: 'https://whitefiresuppression.com',
    linkedin_url: 'https://linkedin.com/in/brianwhite',
    street_address: '8901 Music Row',
    city: 'Nashville',
    state: 'TN',
    zip_code: '37203',
    bio: 'Fire protection systems contractor specializing in sprinkler systems, fire alarms, and suppression systems for commercial buildings.',
    years_in_business: 11,
    team_size: '10-20',
    tin_number: '90-1234568',
    is_public: true,
    vetting_status: 'pending',
  },
  {
    email: 'stephanie.moore@excavation-services.com',
    full_name: 'Stephanie Moore',
    company_name: 'Moore Excavation Services',
    phone: '(555) 012-3457',
    business_type: 'Partnership',
    primary_trade: 'Excavation',
    service_areas: ['Charlotte', 'Raleigh', 'Durham'],
    website: 'https://mooreexcavation.com',
    linkedin_url: 'https://linkedin.com/in/stephaniemoore',
    street_address: '9012 Tryon Street',
    city: 'Charlotte',
    state: 'NC',
    zip_code: '28202',
    bio: 'Professional excavation and site preparation contractor. Specialized equipment for commercial developments and utility installations.',
    years_in_business: 14,
    team_size: '20-50',
    tin_number: '12-3456781',
    is_public: true,
    vetting_status: 'approved',
  },
];

async function populateDatabase() {
  console.log('Starting database population with 20 dummy profiles...\n');

  for (let i = 0; i < dummyProfiles.length; i++) {
    const profile = dummyProfiles[i];

    try {
      // Insert profile (without vetting_status as it's in applications table)
      const { data: profileData, error: profileError } = await supabase
        .from('profiles')
        .upsert({
          email: profile.email,
          full_name: profile.full_name,
          company_name: profile.company_name,
          phone: profile.phone,
          business_type: profile.business_type,
          primary_trade: profile.primary_trade,
          service_areas: profile.service_areas,
          website: profile.website,
          linkedin_url: profile.linkedin_url,
          street_address: profile.street_address,
          city: profile.city,
          state: profile.state,
          zip_code: profile.zip_code,
          bio: profile.bio,
          years_in_business: profile.years_in_business,
          team_size: profile.team_size,
          tin_number: profile.tin_number,
          is_public: profile.is_public,
        })
        .select()
        .single();

      if (profileError) {
        console.error(`‚ùå Error inserting ${profile.full_name}:`, profileError.message);
        continue;
      }

      console.log(`‚úÖ [${i + 1}/20] Added: ${profile.full_name} (${profile.company_name}) - Status: ${profile.vetting_status}`);

      // Create a corresponding application with status
      if (profileData?.id) {
        const { error: appError } = await supabase
          .from('applications')
          .insert({
            user_id: profileData.id,
            status: profile.vetting_status,
            tos_accepted: true,
            tos_accepted_at: new Date().toISOString(),
          });

        if (appError && !appError.message.includes('duplicate')) {
          console.log(`   ‚ö†Ô∏è  Warning: Could not create application for ${profile.full_name}: ${appError.message}`);
        } else {
          console.log(`   üìù Application created with status: ${profile.vetting_status}`);
        }
      }

    } catch (error) {
      console.error(`‚ùå Unexpected error with ${profile.full_name}:`, error);
    }
  }

  console.log('\n‚ú® Database population completed!');
  console.log('\nSummary:');
  console.log(`- Total profiles: 20`);
  console.log(`- Approved: ${dummyProfiles.filter(p => p.vetting_status === 'approved').length}`);
  console.log(`- Pending: ${dummyProfiles.filter(p => p.vetting_status === 'pending').length}`);
  console.log(`- Rejected: ${dummyProfiles.filter(p => p.vetting_status === 'rejected').length}`);
}

populateDatabase().catch(console.error);
